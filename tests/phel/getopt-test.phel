(ns tests\smeghead\getopt\getopt-test
  (:require smeghead\getopt\getopt)
  (:require phel\test :refer [deftest is]))

(deftest run-no-argv
  (let [options []
        result (getopt/getopt [] options)]
    (is (= (result :args) []))
    (is (= (result :options) {}))))

(deftest run-2-arguments
  (let [options []
        result (getopt/getopt ["one" "two"] options)]
    (is (= (result :args) ["one" "two"]))
    (is (= (result :options) {}))))

(deftest option-short-options
  (let [options ["-a"]
        result (getopt/getopt ["-a" "one" "two"] options)]
    (is (= (result :args) ["one" "two"]))
    (is (= (result :options) {:a true}))))

(deftest option-short-options-require-value
  (let [options ["-a:"]
        result (getopt/getopt ["-a" "param" "one" "two"] options)]
    (is (= (result :args) ["one" "two"]))
    (is (= (result :options) {:a "param"}))))

(deftest option-long-options
  (let [options ["--amazing"]
        result (getopt/getopt ["--amazing" "one" "two"] options)]
    (is (= (result :args) ["one" "two"]))
    (is (= (result :options) {:amazing true}))))

(deftest option-unknown-options
  (let [options ["-a"]
        result (getopt/getopt ["--unknown" "one" "two"] options)]
    (is (= (result :args) ["one" "two"]))
    (is (= (result :options) {}))))

(deftest option-give-up-parse-after---
  (let [options ["-a"]
        result (getopt/getopt ["--" "-a" "one" "two"] options)]
    (is (= (result :args) ["-a" "one" "two"]))
    (is (= (result :options) {}))))
